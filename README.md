# [실전! 스프링 부트와 JPA 활용1 - 웹 애플리케이션 개발](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/dashboard)

## 2. 프로젝트 환경설정

### 프로젝트 생성

- `Spring Initializr Java Support` extension으로 프로젝트 생성했다.
- groupId
  - 프로젝트를 만든 조직이나 그룹을 식별하는 ID
  - 보통 도메인을 거꾸로 쓴 형식 (예: com.example, org.springframework.boot)
- artifactId
  - 해당 프로젝트(모듈)의 고유 이름을 의미
  - user-api, order-service, auth-core
- 요즘은 `jsp`보다 `thymeleaf` 권장
- DB는 mysql8을 사용함

### 라이브러리 살펴보기

- `./gradlew dependencies`: 의존관계 설명

### View 환경 설정

- `thymeleaf`를 spring에서 밀어줌 + 사용법을 약간 익혀야한다

### H2 데이터베이스 설치

### JPA와 DB 설정, 동작확인

- show_sql속성은 system out을 통해 출력하기에 logging으로 출력 하는게 권장된다.
- `@PersistenceContext`: 부트가 엔티티매니저 객체 주입
- save하고 멤버 대신 id를 반환하는건 커맨드와 쿼리를 분리해라를 따르는 것
  - 명령과 조회의 분리
  - Command 데이터를 변경하는 작업 (예: save(), delete(), update())
  - Query 데이터를 조회하는 작업 (예: findById(), getUser())
- 인텔리제이에 테스트 코드를 생성해주는 기능이 있는 것 같은데 `Symflower` 익스텐션으로 대체
- `@Transactional`는 spring 껄 import할 것
- 왠만한 라이브러리들은 스프링부트에서는 해당 부트버전에 적합한 버전이 이미 정해져있음 그래서 라이브러리 버전을 명시하지 않아도 그 버전을 사용
- `p6spy-spring-boot-starter`는 파라미터까지 sql에 넣어보여줘 좋지만 운영 배포까지는 성능적 문제로 고민 필요

## 3. 도메인 분석 설계

### 요구사항 분석

- 회원 기능
  - 회원 등록
  - 회원 조회
- 상품 기능
  - 상품 등록
  - 상품 수정
  - 상품 조회
- 주문 기능
  - 상품 주문
  - 주문 내역 조회
  - 주문 취소
- 기타 요구사항
  - 상품은 재고 관리가 필요하다.
  - 상품의 종류는 도서, 음반, 영화가 있다.
  - 상품을 카테고리로 구분할 수 있다.
  - 상품 주문시 배송 정보를 입력할 수 있다.

### 도메인 모델과 테이블 설계

- 개념들을 모델화하고 모델들의 관계를 고려
- 내용 및 설계 구조가 ORM 기본편에서 나온 것과 유사
- 외래 키가 있는 곳을 연관관계의 주인

  - 연관관계의 주인은 단순히 외래 키를 누가 관리하냐의 문제
  - 연관관계의 주인을 반대로 정하면 관리하지 않는 테이블의 외래 키 값이 업데이트 되므로 관리와 유지보수가 어렵고
  - 추가적으로 별도의 업데이트 쿼리가 발생하는 성능 문제도 있다.

### 엔티티 클래스 개발1

- @OneToOne 에선 포린키를 많이 어세스 하는 쪽에 두는 것을 선호

### 엔티티 클래스 개발2

- mysql enum 값 필수
- 값 타입은 변경 불가능하게 설계해야 한다. - address
  - JPA 스펙상 엔티티나 임베디드 타입( @Embeddable )은 자바 기본 생성자 default constructor)를 public 또는 protected 로 설정해야 한다.
  - JPA가 이런 제약을 두는 이유는 JPA 구현 라이브러리가 객체를 생성할 때 리플랙션 같은 기술을 사용할 수 있도록 지원해야 하기 때문이다.
- 생성된 스크립트를 바탕으로 검증하고 사용해라

### 엔티티 설계시 주의점

- 엔티티 설계시 주의점
  - 엔티티에는 가급적 Setter를 사용하지 말자 - 도메인(비즈니스) 메서드
- 모든 연관관계는 지연로딩으로 설정!
  - 즉시로딩(EAGER)은 예측이 어렵고, 어떤 SQL이 실행될지 추적하기 어렵다.
  - 특히 JPQL을 실행할 때 N+1 문제가 자주 발생한다.
  - 실무에서 모든 연관관계는 지연로딩(LAZY)으로 설정해야 한다.
  - 연관된 엔티티를 함께 DB에서 조회해야 하면, fetch join 또는 엔티티 그래프 기능을 사용한다.
- 컬렉션은 필드에서 초기화 하자.
  - null 문제에서 안전하다.
- 테이블, 컬럼명 생성 전략
  - 스프링 부트에서 하이버네이트 기본 매핑 전략을 변경해서 실제 테이블 필드명은 다름
  - 하이버네이트 기존 구현: 엔티티의 필드명을 그대로 테이블의 컬럼명으로 사용(SpringPhysicalNamingStrategy)
  - 스프링 부트 신규 설정 - 카멜 케이스 -> 언더스코어(memberPoint member_point)

## 4. 애플리케이션 구현 준비

- 로그인과 권한 관리X
- 파라미터 검증과 예외 처리X
- 계층형 구조 사용
  - controller, web: 웹 계층
  - service: 비즈니스 로직, 트랜잭션 처리
  - repository: JPA를 직접 사용하는 계층, 엔티티 매니저 사용
  - domain: 엔티티가 모여 있는 계층, 모든 계층에서 사용
- controller -> service -> repository -> DB
  - 서비스가 불필요하다면 controller에서 레포를 바로 호출하게 처리할 것이다.
    - 방향은 단뱡항으로 간다.
    - 좀더 실용적인데, 실무에서도 이렇게 할지는 애매
- 개발 순서: 서비스, 리포지토리 계층을 개발하고, 테스트 케이스를 작성해서 검증, 마지막에 웹 계층 적용

## 5. 회원 도메인 개발

### 회원 리포지토리 개발

### 회원 서비스 개발

### 회원 기능 테스트

## 6. 상품 도메인 개발

### 상품 엔티티 개발(비즈니스 로직 추가)

### 상품 리포지토리 개발

### 상품 서비스 개발

## 7. 주문 도메인 개발

### 주문, 주문상품 엔티티 개발

### 주문 리포지토리 개발

### 주문 서비스 개발

### 주문 기능 테스트

### 주문 검색 기능 개발

## 8. 웹 계층 개발

### 홈 화면과 레이아웃

### 회원 등록

### 회원 목록 조회

### 상품 등록

### 상품 목록

### 상품 수정

### 변경 감지와 병합(merge)

### 상품 주문

### 주문 목록 검색, 취소

### 다음으로
